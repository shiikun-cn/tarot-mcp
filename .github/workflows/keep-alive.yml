name: keep-alive-ping

on:
  schedule:
    # 每 10 分钟触发一次（调整为 8/9 分钟也可）。cron 的分钟字段为 UTC，请按需换算。
    - cron: '*/10 * * * *'
  workflow_dispatch: # 手动也能触发

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping service health
        env:
          URL: https://tarot-mcp.onrender.com/_warmup   # 或 /health
          API_KEY: ${{ secrets.SERVICE_API_KEY }}       # 在 GitHub 仓库 Secrets 里设置
        run: |
          echo "Pinging $URL"
          # 使用 curl，超时时间设置短些（例如 10s），失败不会中断 workflow（但可记录）
          curl -sS --max-time 10 -I -H "X-API-KEY: $API_KEY" "$URL" || echo "Ping failed at $(date)"
